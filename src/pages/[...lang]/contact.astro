---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import ItemGrid3 from '~/components/ui/ItemGrid3.astro';
import type { ContentEntryMap } from "astro:content";
import { getListPage } from "~/utils/lib/contentParser.astro";
import { supportedLang } from "~/utils/lib/languageParser";

export function getStaticPaths() {
  const paths = supportedLang.map((lang) => ({
    params: { lang: lang || undefined },
  }));
  return paths;
}

const { lang } = Astro.params;

const contactPage = await getListPage("contact", lang as keyof ContentEntryMap);
if (!contactPage || contactPage.length === 0 || !contactPage[0].data) {
  throw new Error("Contact content not found for language: " + lang);
}

const { metadata, hero, contactForm, features, locations } = contactPage[0].data;

const defaultLocationImages = [
  {
    src: '~/assets/images/map-herndon.jpg',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/Capitol+Law+Partners/data=!4m2!3m1!1s0x0:0xdd25a8b02491aacd?sa=X&ved=1t:2428&ictx=111',
  },
  {
    src: '~/assets/images/map-washington.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/Capitol+Law+Partners/@38.8981849,-77.0307687,17z/data=!3m2!4b1!5s0x89b7b7bdf11bb751:0xf9b2c66482b778ff!4m6!3m5!1s0x89b7b79fdc4c0afd:0x70647fab40f6ef1b!8m2!3d38.8981808!4d-77.0281938!16s%2Fg%2F11y23hfk14?entry=ttu&g_ep=EgoyMDI1MDUxMy4xIKXMDSoASAFQAw%3D%3D',
  },
  {
    src: '~/assets/images/map-newyork.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/14+Wall+St+20th+Floor,+New+York,+NY+10005',
  },
  {
    src: '~/assets/images/map-istanbul-1.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/Trump+Towers/data=!4m2!3m1!1s0x0:0x9ce9fcc6cd43250?sa=X&ved=1t:2428&ictx=111',
  },
  {
    src: '~/assets/images/minneapolis-office.png',
    alt: 'Maps location image',
    href: 'https://www.google.com/maps/place/5775+Wayzata+Blvd+Suite+700,+St+Louis+Park,+MN+55416/@44.9694331,-93.3824122,13.31z/data=!4m6!3m5!1s0x52b334bd9ceaaaab:0x6ad439e33864c71e!8m2!3d44.9688915!4d-93.3538241!16s%2Fg%2F11mhjvs72_?entry=ttu&g_ep=EgoyMDI1MTExNy4wIKXMDSoASAFQAw%3D%3D',
  },
];

const locationItems = Array.isArray(locations) ? locations : locations?.items ?? [];



---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->
  <HeroText tagline={hero.tagline} title={hero.title} />

  <!-- ContactUs Widget ******************* -->
  <ContactUs
    id="form"
    title={contactForm.title}
    subtitle={contactForm.subtitle}
    inputs={[
      { type: 'text', name: 'name', label: contactForm.inputs.name },
      { type: 'email', name: 'email', label: contactForm.inputs.email },
      { type: 'tel', name: 'phone', label: contactForm.inputs.phone },
    ]}
    textarea={{ label: contactForm.textarea }}
    disclaimer={{ label: contactForm.disclaimer }}
    description={contactForm.description}
  />

  <!-- Features2 Widget ******************* -->
  <Features2
    title={features.title}
    items={features.items}
  />

  <!-- ItemGrid3 Widget for Office Locations ******************* -->
  <ItemGrid3
    items={locationItems.map((loc, index) => ({
      title: loc.title,
      description: loc.description,
      image: loc.image ?? defaultLocationImages[index],
    }))}
    columns={3}
    classes={{
      container: 'gap-4 md:gap-6',
      panel: 'rounded-lg shadow-[0_4px_30px_rgba(0,0,0,0.1)] backdrop-blur border border-[#ffffff29] bg-white p-6',
      icon: 'w-16 h-16 mb-6 text-primary',
    }}
  />
</Layout>
