---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ItemGrid3 from '~/components/ui/ItemGrid3.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Features2 from '~/components/widgets/Features2.astro';
import type { ContentEntryMap } from "astro:content";
import { getListPage } from "~/utils/lib/contentParser.astro";
import { supportedLang } from "~/utils/lib/languageParser";

export function getStaticPaths() {
  const paths = supportedLang.map((lang) => ({
    params: { lang: lang || undefined },
  }));
  return paths;
}

const { lang } = Astro.params;

const locationsPage = await getListPage("locations", lang as keyof ContentEntryMap);
if (!locationsPage || locationsPage.length === 0 || !locationsPage[0].data) {
  throw new Error("Locations content not found for language: " + lang);
}

const { metadata, hero, locations, callToAction, features } = locationsPage[0].data;
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->
  <HeroText tagline={hero.tagline} title={hero.title} />

  <!-- ItemGrid3 Widget for Office Locations ******************* -->
  <ItemGrid3
    items={locations.map((loc) => ({
      title: loc.title,
      description: loc.description,
      image: loc.image,
    }))}
    columns={3}
    classes={{
      container: 'gap-4 md:gap-6',
      panel: 'rounded-lg shadow-[0_4px_30px_rgba(0,0,0,0.1)] backdrop-blur border border-[#ffffff29] bg-white p-6',
      icon: 'w-16 h-16 mb-6 text-primary',
    }}
  />

  <!-- CallToAction Widget *********** -->
  {callToAction && (
    <CallToAction
      actions={[
        {
          variant: 'primary',
          text: callToAction.buttonText,
          href: callToAction.href || '/contact',
        },
      ]}
    >
      <Fragment slot="title">
        {callToAction.title}
      </Fragment>
      <Fragment slot="subtitle">
        {callToAction.subtitle}
      </Fragment>
    </CallToAction>
  )}

  <!-- Features2 Widget ******************* -->
  <Features2
    title={features.title}
    items={features.items}
  />
</Layout>
