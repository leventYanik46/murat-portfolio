---
import Image from '~/components/common/Image.astro';
import FormContainer from '~/components/ui/Form.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import type { Service as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  image = await Astro.slots.render('image'),
  inputs,
  textarea,
  disclaimer,
  button,
  description,
  infoTitle,
  infoDescription,
  googleReview,
  id,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

---

<section class="relative md:-mt-[76px] not-prose" {...id ? { id } : {}}>
  <!-- Background slot container -->
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : null}
    </slot>
  </div>

  <!-- Main image container -->
  <div class="h-[39px] w-full hidden md:block"></div>
  <div class="relative w-full min-h-[50vh] md:min-h-[80vh]">
    <div class="absolute inset-0">
      <!-- Image container -->
      {
        image && (
          <div class="relative w-full h-full">
            {typeof image === 'string' ? (
              <Fragment set:html={image} />
            ) : (
              <Image
                class="w-full h-full object-cover"
                layout="cover"
                widths={[720, 1080, 1440, 1920, 2400]}
                sizes="100vw"
                loading="eager"
                fetchpriority="high"
                {...image}
              />
            )}
          </div>
        )
      }
    </div>
    <WidgetWrapper
      id={id}
         containerClass={`max-w-6xl mx-auto px-4 md:px-6 py-8 md:py-12 lg:py-16 ${classes?.container ?? ''}`}
      bg={bg}
    >
          <div class="w-full flex flex-col lg:flex-row items-start gap-6 lg:gap-8">
        {(infoTitle || infoDescription || googleReview) && (
          <div class="w-full lg:w-5/12 rounded-lg border border-gray-200 bg-white/60 shadow-sm p-4 sm:p-6 lg:p-7">
            {infoTitle && (
              <h2 class="text-2xl md:text-3xl font-bold text-gray-900 leading-tight" set:html={infoTitle} />
            )}
            {infoDescription && (
              <p class="mt-3 text-base md:text-lg text-gray-700 leading-relaxed" set:html={infoDescription} />
            )}
            {googleReview && (
              <div class="mt-5 inline-flex w-full flex-wrap items-center gap-4 rounded-xl border border-gray-200 bg-white px-4 py-3 shadow-sm">
                <div
                  class="flex h-12 w-12 items-center justify-center rounded-full bg-[#4285F4]/10 text-lg font-semibold text-[#4285F4]"
                  aria-hidden="true"
                >
                  G
                </div>
                <div class="flex-1 min-w-[200px]">
                  <p class="text-sm font-semibold text-gray-900">{googleReview.label ?? 'Google Reviews'}</p>
                  <div class="mt-1 flex flex-wrap items-center gap-2 text-sm text-gray-700">
                    <span class="flex items-center gap-1 text-amber-400" aria-hidden="true">
                      {Array.from({ length: 5 }).map((_, index) => (
                        <svg
                          key={index}
                          viewBox="0 0 20 20"
                          class="h-4 w-4 fill-current"
                          aria-hidden="true"
                        >
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.09 3.355a1 1 0 00.95.69h3.527c.969 0 1.371 1.24.588 1.81l-2.856 2.074a1 1 0 00-.364 1.118l1.09 3.356c.3.921-.755 1.688-1.54 1.118l-2.856-2.074a1 1 0 00-1.176 0l-2.856 2.074c-.784.57-1.838-.197-1.539-1.118l1.09-3.356a1 1 0 00-.364-1.118L1.793 8.782c-.783-.57-.38-1.81.588-1.81h3.527a1 1 0 00.95-.69l1.09-3.355z" />
                        </svg>
                      ))}
                    </span>
                    {
                      googleReview.rating && (
                        <Fragment>
                          <span class="font-semibold text-gray-900">{googleReview.rating}</span>
                          <span class="text-gray-500">/ 5</span>
                        </Fragment>
                      )
                    }
                    {googleReview.count && <span class="text-gray-500">({googleReview.count} reviews)</span>}
                    {googleReview.url && (
                      <a
                        class="text-primary font-semibold hover:underline"
                        href={googleReview.url}
                        target="_blank"
                        rel="noreferrer"
                      >
                        View on Google
                      </a>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
               )}
        {
          inputs && (
            <div class="w-full lg:w-7/12">
              <div class="flex flex-col max-w-xl w-full ml-auto rounded-lg backdrop-blur border border-gray-200 bg-white shadow p-3 sm:p-4 lg:p-5">
                <Headline
                  title={title}
                  tagline={tagline}
                  subtitle={subtitle}
                  classes={{
                    container: 'max-w-xl mb-6 md:mb-8',
                    title: 'text-2xl md:text-3xl lg:text-3xl',
                    subtitle: 'text-sm md:text-base lg:text-base',
                  }}
                />
                <FormContainer
                  inputs={inputs}
                  textarea={textarea}
                  disclaimer={disclaimer}
                  button={button}
                  description={description}
                  compact={true}
                />
              </div>
            </div>
          )
        }
      </div>
    </WidgetWrapper>
  </div>
</section>
